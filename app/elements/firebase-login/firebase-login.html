<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="firebase-login">
  <template>
    <style>
      :host {
        display: block;
      }
      #btnLogin {
        cursor: pointer;
      }
      #btnLogout {
        display: none;
      }
      #btnLogin:hover {
        color: var(--accent-color);
      }
      #loginModal {
        background-color: white;
        width: 500px;
      }
      .buttons {
        margin-top: 15px;
      }
      #pass-signin {
        margin-top: 15px;
        background-color: var(--dark-primary-color);
        color: var(--text-primary-color);
      }
      #google-signin {
        margin-top: 15px;
        background-color: darkred;
        color: var(--text-primary-color);
      }
    </style>

    <firebase-auth id="firebaseLogin"  location="{{location}}"
                                                            user="{{user}}"
                                                            provider="{{provider}}"
                                                            status-known="{{statusKnown}}"
                                                            on-login="onFirebaseLogin"
                                                            on-logout="onFirebaseLogout"
                                                            on-error="errorHandler"
                                                            on-user-created="userSuccessHandler"
                                                            on-password-changed="userSuccessHandler"
                                                            on-password-reset="userSuccessHandler"
                                                            on-user-removed="userSuccessHandler"></firebase-auth>

    <paper-button id="btnLogin" data-dialog="login-modal" on-tap="toggleLogin"><iron-icon icon="account-box"></iron-icon>Login</paper-button>
    <paper-button id="btnLogout" on-tap="logout"><iron-icon icon="account-box"></iron-icon>Logout</paper-button>
    <paper-dialog id="loginModal" with-backdrop
                            entry-animation="scale-up-animation"
                            exit-animation="fade-out-animation">
      <h2>Login</h2>
      <paper-input label="email" id="email"></paper-input>
      <paper-input label="password" type="password" id="pass"></paper-input>
      <div class="buttons">
        <!-- <paper-button raised id="google-signin"><iron-icon icon="account-circle"></iron-icon>Google Signin</paper-button> -->
        <paper-button raised id="pass-signin" on-tap="login"><iron-icon icon="forward"></iron-icon>Lets Go!</paper-button>
      </div>
    </paper-dialog>
  </template>
  <script>
  (function() {
    'use strict';

    Polymer({
      is: 'firebase-login',

      properties: {
        user: {
          type: Object,
          value: null,
          notify: true
        },
        location: {
          type: String,
          value: 'https://shokka.firebaseio.com',
          notify: true
        },
        provider: {
          type: String,
          value: 'password'
        },
        statusKnown: {
          type: Boolean
        },
        params: {
          type: Object,
          value: {scope: 'email'}
        },
        message: {
          type: String,
        }
      },

      toggleLogin: function() {
          this.$.loginModal.toggle();
      },
      login: function(e) {
        var email = this.$.email.value
        var pass = this.$.pass.value
        this.$.firebaseLogin.login({email:email, password:pass})
        this.message = 'Login result: ' + e.detail.user
        this.log(this.message)
      },
      logout: function(e){
        this.$.firebaseLogin.logout()
      },
      onFirebaseLogin: function(e) {
        this.message = 'User info: ' + JSON.stringify(this.user)
        this.log(this.message)
        this.$.btnLogin.style.display = 'none'
        this.$.btnLogout.style.display = 'block'
        this.$.loginModal.close()
      },
      onFirebaseLogout: function(e) {
        this.$.btnLogin.style.display = 'block'
        this.$.btnLogout.style.display = 'none'
        // TODO: handle clearing user data on the page and showing either the login modal or a splash screen or something
      },
      errorHandler: function(e) {
        this.log('Login Status')
        this.message = 'Error: ' + e.detail.message
        this.log(this.message)
      },
      userSuccessHandler: function(e) {
        this.message = e.type + ' success!'
      },
      log: function(log) {
        var d = new Date()
        var n = d.getTime()
        //this.$.firebaseDocument.query.ref().push({log: log, time: n, user: this.user}) //TODO: setup firebase to have a log location
        console.log('log: ' + log + ' | time: ' + n + ' | user: ' + this.user)
      }
    });
  })();
  </script>
</dom-module>
