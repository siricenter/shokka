<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/marked-element/marked-element.html">

<dom-module id="shokka-edit-module">
  <template>
    <script type="text/javascript" src="../shokka-evaluation/shokka-evaluation-functions.js"></script>
    <style include="shared-styles"></style>
    <style>
      :host {
        display: block;
      }

      paper-material {
        display: flex;
        flex-direction: column;
      }

      paper-textarea {
        margin: 2rem 0 1rem;

        --paper-input-container-label-floating: {
          font-size: 2rem;
          font-weight: bold;
          padding-bottom: .5rem;
          color: #333;
        };
      }

      label {
        display: block;
        font-size: 2rem;
        font-weight: bold;
        padding-bottom: .5rem;
        color: #333;
        line-height: 24px;
        transform: scale(0.75);
        transform-origin: left top;
      }

      #preview {
        display: none;
      }

      #preview.open {
        display: flex;
        flex-direction: column;
      }

      paper-button {
        align-self: flex-end;
        margin-top: -1rem;
      }
      #tooltipButton:before {
        content: "Markdown Help";
      }
      .toggle {
        padding:10px 15px;
        font-size: 1rem;
        cursor: pointer;
      }
      .collapse-content {
        padding: 15px;
        border: 1px solid #dedede;
      }
      #previewButton:before {
        display: block;
        content: "SHOW PREVIEW";
      }

      #previewButton[active]:before {
        content: "HIDE PREVIEW";
      }
      .delete {
        color: var(--primary-text-color);
        background-color: var(--secondary-accent-color);
      }
      .done {
        background-color: var(--accent-color);
      }
      paper-material {
        padding: 2rem;
      }
      .buttons {
        margin-top: 2rem;
      }
    </style>
    <firebase-document  id="moduleLocation"
                        location="{{moduleLocation}}"
                        on-firebase-value="_fbReturned"
                        data="{{module}}"></firebase-document>
    <paper-material elevation="1">
      <h1><paper-input label="Name" value="{{module.name}}"></paper-input></h1>
      <paper-textarea label="Description" value="{{module.desc}}"></paper-textarea>
      <button class="toggle" on-click="toggleTooltip">Markdown Help</button>
      <iron-collapse id="collapse">
        <div class="collapse-content">
<h2>Syntax guide</h2>

<p>Hereâ€™s an overview of Markdown syntax that you can use anywhere on GitHub.com or in your own text files.</p>

<h3>Headers</h3>

<div class="language-markdown highlighter-rouge">
<pre class="highlight"><code><span class="gh"># This is an &lt;h1&gt; tag</span>
<span class="gu">## This is an &lt;h2&gt; tag</span>
<span class="gu">###### This is an &lt;h6&gt; tag</span>
</code></pre>
</div>

<h3>Emphasis</h3>

<div class="language-markdown highlighter-rouge">
<pre class="highlight"><code><span class="ge">*This text will be italic*</span>
<span class="ge">_This will also be italic_</span>

<span class="gs">**This text will be bold**</span>
<span class="gs">__This will also be bold__</span>

<span class="ge">_You **can** combine them_</span>
</code></pre>
</div>

<h3>Lists</h3>

<h4>Unordered</h4>

<div class="language-markdown highlighter-rouge">
<pre class="highlight"><code><span class="p">*</span> Item 1
<span class="p">*</span> Item 2
<span class="p">  *</span> Item 2a
<span class="p">  *</span> Item 2b
</code></pre>
</div>

<h4>Ordered</h4>

<div class="language-markdown highlighter-rouge">
<pre class="highlight"><code><span class="p">1.</span> Item 1
<span class="p">2.</span> Item 2
<span class="p">3.</span> Item 3
<span class="p">   *</span> Item 3a
<span class="p">   *</span> Item 3b
</code></pre>
</div>

<h3>Images</h3>

<div class="language-markdown highlighter-rouge">
<pre class="highlight"><code><span class="p">![</span><span class="nv">GitHub Logo</span><span class="p">](</span><span class="sx">/images/logo.png</span><span class="p">)</span>
Format: !<span class="p">[</span><span class="nv">Alt Text</span><span class="p">](</span><span class="sx">url</span><span class="p">)</span>
</code></pre>
</div>

<h3>Links</h3>

<div class="language-markdown highlighter-rouge">
<pre class="highlight"><code>http://github.com - automatic!
<span class="p">[</span><span class="nv">GitHub</span><span class="p">](</span><span class="sx">http://github.com</span><span class="p">)</span>
</code></pre>
</div>

<h3>Blockquotes</h3>

<div class="language-markdown highlighter-rouge">
<pre class="highlight"><code>As Kanye West said:
<span class="gt">
&gt; We're living the future so</span>
<span class="gt">&gt; the present is our past.</span>
</code></pre>
</div>

<h3>Inline code</h3>

<div class="highlighter-rouge">
<pre class="highlight"><code>I think you should use an
`&lt;addr&gt;` element here instead.
</code></pre>
</div>

      </div>
        </div>
      </iron-collapse>
      <paper-textarea label="Content" value="{{module.content}}"></paper-textarea>
      <button class="toggle" on-click="togglePreview">Preview</button>
      <iron-collapse id="collapsePreview">
        <div class="collapse-content">
          <marked-element markdown="{{module.content}}"></marked-element>
        </div>
      </iron-collapse>
      <div class="buttons">
        <paper-button class="delete" on-tap="remove">DELETE</paper-button>
        <paper-button class="done" on-tap="done">DONE</paper-button>
      </div>
    </paper-material>
  </template>

  <script>
    (function() {
      'use strict';
      
      Polymer({
        is: 'shokka-edit-module',

        properties: {
          previewOpen: {
            type: Boolean,
            value: false,
            notify: true
          }
        },

        observers:[
          '_setModuleLocation(baseRef, orgId, moduleId)'
        ],
        
        _setModuleLocation: function(baseRef, orgId, moduleId) {
          if (moduleId === null || moduleId === undefined) {
            this.moduleId = window.EF._uid();
          } else {
            this.moduleLocation = baseRef + '/orgs/' + orgId + '/modules/' + moduleId;
          }
        },
        toggleTooltip: function() {
          this.$.collapse.toggle();
        },
        togglePreview: function() {
          this.$.collapsePreview.toggle();
        },

        _fbReturned: function(){
          if (this.module === null || this.module === undefined) {
            this.set('module', {});
          }
        },

        remove: function(){
          this.set('module', window.EF.getNullObject(this.module));
          window.page('#!/modules');
        },

        done: function(){
          window.page('#!/modules');
        },

        ready: function() {
          // this.$.preview.classList.add(this.previewOpen ? 'open' : null);
          // this.$.previewButton.active = this.previewOpen;
        }
      });
    })();
  </script>

</dom-module>
