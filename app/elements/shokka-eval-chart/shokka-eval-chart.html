<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="shokka-eval-chart">
  <template>
    <google-chart id="{{id}}" 
                  type="{{type}}" 
                  options='{{options}}'
                  data='[[userData]]'>
    </google-chart>
  </template>
  <script>
  (function() {
    'use strict';

    Polymer({
      is: 'shokka-eval-chart',

      properties: {
        id: {
          type: String,
          value: ''
        },
        userData: {
          type: Array,
          computed: '_setUserData(userAvgEvals)'
        },
        options: {
          type: Object,
          computed: '_computeOptions(id)'
        },
        type: {
          type: String,
          computed: '_computeType(id)'
        },
        header: {
          type: Array,
          value: ['Date', 'Professionalism', 'Skills', 'Work Completion' ]
        }
      },

      _computeType: function(id) {
        if (id === 'overTime') {
          return 'line';
        }
        return 'column';
      },

      _computeOptions: function(id){
        if (id === 'comparison') {
          return { 'title': 'Evaluation Comparison' };
        }
        else if (id === 'last') {
          return { 'title': 'Last Evaluation', 
                  'vAxis': { 'minValue': 0, 'maxValue': 100 }, 
                  'legend': { 'position': 'bottom'},
                  'hAxis': { 'textPosition': 'none' },
                  'chartArea': { 'width': '90%', 'height': '70%' } };
        }
        else if (id === 'overTime') {
          return { 'title': 'Performance Over Time', 'curveType': 'function' };
        }
        return {};
      },

      _setUserData: function(userAvgEvals) {
        var userData = [ this.header ];
        if (this.id === 'last') {
          var arr = Object.keys( userAvgEvals ).map(function ( key ) { 
            return userAvgEvals[key]; 
          });
          arr.sort(function(a, b){ return a.date.localeCompare(b.date); });
          var toAdd = arr[arr.length - 1];
          userData.push([toAdd.date, toAdd.professionalism, toAdd.skills, toAdd.productivity]);
        }
        else {
          for (var key in userAvgEvals) {
            // skip loop if the property is from prototype
            if (!userAvgEvals.hasOwnProperty(key)) {
              continue;
            }
            var tmp = ['', 0, 0, 0];
            var obj = userAvgEvals[key];
            for (var prop in obj) {
              // skip loop if the property is from prototype
              if(!obj.hasOwnProperty(prop)) {
                continue;
              }
              
              if(prop === 'date'){
                tmp[0] = obj[prop];
              }
              else if(prop === 'professionalism'){
                tmp[1] = obj[prop];
              }
              else if(prop === 'skills'){
                tmp[2] = obj[prop];
              }
              else if(prop === 'productivity'){
                tmp[3] = obj[prop];
              }
            }
            userData.push(tmp);
          }
        }
        return userData;
      }
  });
  })();
  </script>
</dom-module>
